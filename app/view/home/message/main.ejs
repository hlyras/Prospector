<script>
  async function receivedMessage({ data, message }) {
    console.log('data', data);

    let sender = lib.splitTextBy(data.key.remoteJid, "@")[0];
    console.log('sender', sender);
    if (!sender) return;

    let contact_div = document.getElementById(`contact-${sender}`);

    let profile_picture = document.getElementById(`profile-picture-${sender}`);

    if (data.profile_picture && profile_picture?.dataset.empty) {
      let response = await API.response(Contact.update, {
        phone: sender,
        profile_picture: data.profile_picture
      }, profile_picture);

      response.done && (profile_picture.src = data.profile_picture);
    } else {
      if (profile_picture?.src && profile_picture?.src != data.profile_picture) {
        let response = await API.response(Contact.update, {
          profile_picture: data.profile_picture
        }, profile_picture);
      }
    }

    let last_message_datetime = document.getElementById(`last-message-datetime-${sender}`);
    last_message_datetime.innerHTML = "";
    last_message_datetime.innerHTML = lib.timestampToFulldate(message.datetime);

    let last_message = document.getElementById(`last-message-${sender}`);
    last_message.innerHTML = "";
    last_message.innerHTML = message.content;
  };
</script>